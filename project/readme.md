# Итоговая работа по курсу
[**Вернуться обратно**](https://github.com/takmenevag/otus-dc-design/tree/main/)
## Задачи
- организация геораспределенной отказоустойчивой сети передачи данных центра обработки данных с использованием технологии VXLAN

## Решение

### Распределение адресного пространства
<details>
  <summary>Описание распределения IP-адресов </summary>

#### Описание:
- для площадки DC1, DC2 и DC**I** испольузется блок IP-адресов 10.Х.0.0/12
- для каджого POD в DC1 и DC2 испольузется блок IP-адресов 10.Х.0.0/14
- каждый POD в DC1 и DC2 испольузется блок IP-адресов 10.Х.0.0/14
- в каждом POD выделяется:
	- блок /15 для адресации "шкафонезависимых" сегментов в DC
	- блок /16 для адресации "шкафозависимых" сегментов в DC
	- блок /16 выделяется в резевр
- в блок /16 для POD выделяется:
	- блок /23 для каждого ТШ (до 100 шт.)
	- блок /25 для каждого spine (до 124 leaf на POD)
	- блок /25 для каждого border leaf (+/25 в резерв)
	- блок /23 для loopback интерфейсов сетевого оборудования
- адресация для сервисов и огранизации взаимодействии между ЦОД назначается из блока DCI

---
#### Вернеуровневые IP-блоки
|Блок IP-адресов |Назначение|
|:-				|:-|
|10.0.0.0/8		|Блок сетей|
|10.0.0.0/12	|DC**I**|
|10.16.0.0/12	|DC1|
|10.32.0.0/12	|DC2|
|10.48.0.0/12	|DC резерв|
|10.64.0.0/12	|DC резерв|
|10.80.0.0/12	|DC резерв|
|10.96.0.0/12	|DC резерв|
|10.112.0.0/12	|DC резерв|
|10.128.0.0/12	|резерв|
|...			|...|
|10.240.0.0/12	|резерв|

---
#### IP-блоки DCI
|Блок IP-адресов |Назначение|
|:-				|:-|
|10.0.0.0/12	|DCI|
|10.0.0.0/16	|транспорт|
|10.1.0.0/16	|резерв транспорт|
|10.8.0.0/15	|резерв|
|10.4.0.0/14	|резерв|
|10.8.0.0/14	|сервисы DC-независимые|
|10.12.0.0/14	|резерв сервисы|
|||
|10.0.0.0/16	|DCI транспорт|
|10.0.0.0/24	|транспорт|
|10.0.1.0/24	|резерв транспорт|
|||
|10.8.0.0/14	|DCI сервисы|
|10.8.0.0/16	|сервисы|
|10.9.0.0/16	|резерв|
|10.10.0.0/15	|резерв|
|||	
|10.8.0.0/16	|DCI сервисы|
|10.8.10.0/24	|vlan10|
|10.8.20.0/24	|vlan20|
|10.8.30.0/24	|vlan30|
|10.8.40.0/24	|vlan40|

---
#### IP-блоки DC1
|Блок IP-адресов |Назначение|
|:-				|:-|
|10.16.0.0/12	|DC1|
|10.16.0.0/14	|POD1|
|10.20.0.0/14	|POD2|
|10.24.0.0/14	|резерв|
|10.28.0.0/14	|резерв|
|||
|10.16.0.0/14	|POD1|
|10.16.0.0/16	|Cеть+резевр|
|10.17.0.0/16	|резевр|
|10.18.0.0/15	|резерв|
|||
|10.16.0.0/16	|Cеть+резевр|
|…					|…|
|10.16.241.0/24		|dc1-p1-r002-blf-1, r012-blf-1|
|10.16.242.0/24		|резерв|
|10.16.243.0/24		|резерв|
|10.16.244.0/24		|резерв|
|10.16.245.0/24		|резерв|
|10.16.246.0/24		|резерв|
|10.16.247.0/24		|резерв|
|10.16.248.0/24		|резерв| 
|10.16.249.0/24		|dc1-p1-r009-fw-1, r019-fw-1|
|10.16.250.0/25		|dc1-p1-r002-sp-1|
|10.16.250.128/25	|резерв spine|
|10.16.251.0/25		|dc1-p1-r012-sp-1|
|10.16.251.128/25	|резерв spine|
|10.16.252.0/25		|резерв spine|
|10.16.252.128/25	|резерв spine|
|10.16.253.0/25		|резерв spine|
|10.16.253.128/25	|резерв spine|
|10.16.254.0/23		|loopback|
|||
|10.16.254.0/23		|loopback|
|10.16.254.0		|резерв|
|10.16.254.1		|dc1-p1-r002-sp-1|
|10.16.254.2		|dc1-p1-r012-sp-1|
|10.16.254.3		|резерв spine|
|10.16.254.4		|резерв spine|
|10.16.254.5		|резерв spine|
|10.16.254.6		|резерв spine|
|10.16.254.7		|резерв spine|
|10.16.254.8		|резерв spine|
|10.16.254.9		|резерв ss|
|10.16.254.10		|резерв ss|
|10.16.254.11		|dc1-p1-r003-lf-1|
|10.16.254.12		|dc1-p1-r003-lf-2|
|10.16.254.13		|dc1-p1-r013-lf-1|
|10.16.254.14		|dc1-p1-r013-lf-2|
|…					|…|
|10.16.254.187		|dc1-p1-r002-blf-1|
|10.16.254.188		|dc1-p1-r012-blf-1|
|10.16.254.189		|резерв boleaf|
|10.16.254.190		|резерв boleaf|
|10.16.254.191		|dc1-p1-r009-fw-1|

---
#### IP-блоки DC2
*************************************************

</details>

### Распределение номеров AS
<details>
  <summary>Описание распределения номеров AS</summary>

#### Примечание:
- для решения 2xDC, 2xPOD или 4xDC, 1xPOD с leaf < 70 шт. используется 2 байтные номера AS
- для решения с leaf > 70 шт. или других комбинаций DC/POD используется 4 байтные номера AS

В связи с чем ниже приведены 2 варианта распределения номеров AS \
Для лабы взята 2 байтные номера AS для облегчения диагностики

---  
#### Для случая 2xDC, 2xPOD или 4xDC, 1xPOD, leaf < 70 шт.
|Тип	|Номер AS	|X,DC/POD 	|Y|
|:-		|:-			|:-			|:-|
|sspine	|65x00		|1-4		|-|	
|spine	|65x0y		|1-4		|1-8|
|leaf	|65xyy		|1-4		|11-84|
|boleaf	|65xyy		|1-4		|85-90|
|fw		|65xyy		|1-4		|91-95|
|br		|65xyy		|1-4		|96-99|
|host	|646yy		|1 DC/POD	|0-99|
|host	|647yy		|2 DC/POD	|0-99|
|host	|648yy		|3 DC/POD	|0-99|
|host	|649yy		|4 DC/POD	|0-99|

---
#### Для остальных вариантов DC/POD или leaf > 70 шт.
|		|	|DC		|POD	|ТШ		|Тип	|Номер|
|:-		|:-	|:-		|:-		|:-		|:-		|:-|
|**AS**	|42	|Х		|Х		|ХXX	|ХX		|Х|

#### Соответствие типа оборудования и его номера
|Тип| Оборудование|
|:-	|:-|
|0	|host|
|1	|leaf|
|2	|spine|
|3	|sspine|
|4	|fw|
|5	|-|
|6	|-|
|7	|-|
|8	|-|
|9	|br|

--- 
#### Наимнование АСО определяется следующим образом
dcX-pX-rXXX-XX-X

---
</details>

### Наимнование и расположение оборудования
<details>
  <summary>Описание расположения оборудования по ТШ </summary>

#### Примечание:
- в первой таблице приведено расположение оборудования для первых 20 ТШ
- во второй таблице оставлено оборудования для лабы
В связи с чем ниже приведены 2 варианта распределения номеров AS
--- 
#### Расположение оборудования по ТШ с резервированием места
|ТШ	|АСО	|Номер	|Примечание|
|:-	|:-		|:-		|:-|
|1	|кроссы	|-		|-|
|2	|spine	|1		||
|2	|spine	|2		|резерв|
|2	|boleaf	|1		||
|2	|boleaf	|2		|резерв|
|3	|leaf	|1,2	||
|4	|leaf	|1,2	|резерв|
|5	|leaf	|1,2	|резерв|
|6	|leaf	|1,2	|резерв|
|7	|leaf	|1,2	|резерв|
|8	|leaf	|1,2	|резерв|
|9	|fw		|1		||
|10	|br		|1		||
|11	|кроссы	|-		|-|
|12	|spine	|1		||
|12	|spine	|2		|резерв|
|12	|boleaf	|1		||
|12	|boleaf	|2		|резерв|
|13	|leaf	|1,2	||
|14	|leaf	|1,2	|резерв|
|15	|leaf	|1,2	|резерв|
|16	|leaf	|1,2	|резерв|
|17	|leaf	|1,2	|резерв|
|18	|leaf	|1,2	|резерв|
|19	|fw		|1		||
|20	|br		|1		|| 

---
#### Итоговая таблица наименования и расположения в DC1</summary>
Для лабы взяты ASN 2 байта
|ТШ	|Имя для ASN		|Оборудование		|Cокращение	|ASN 4 байта	|ASN 2 байта|
|:-	|:-					|:-					|:-			|:-				|:-|
|2	|dc1-p1-r002-02-1	|dc1-p1-r002-sp-1	|spine-1	|4211002021		|65101|
|12	|dc1-p1-r012-02-1	|dc1-p1-r012-sp-1	|spine-2	|4211012021		|65101|
|3	|dc1-p1-r003-01-1	|dc1-p1-r003-lf-1	|leaf-11	|4211003011		|65111|
|3	|dc1-p1-r003-01-2	|dc1-p1-r003-lf-2	|leaf-12	|4211003012		|65112|
|13	|dc1-p1-r013-01-1	|dc1-p1-r013-lf-1	|leaf-13	|4211013011		|65113|
|13	|dc1-p1-r013-01-2	|dc1-p1-r013-lf-2	|leaf-14	|4211013012		|65114|
|2	|dc1-p1-r002-01-1	|dc1-p1-r002-blf-1	|boleaf-187	|4211002011		|65187|
|12	|dc1-p1-r012-01-1	|dc1-p1-r012-blf-1	|boleaf-188	|4211012011		|65188|
|9	|dc1-p1-r009-04-1	|dc1-p1-r009-fw-1	|fw-1		|4211009041		|65191|
|19	|dc1-p1-r019-04-1	|dc1-p1-r019-fw-1	|fw-2		|4211019041		|65191|
|10	|dc1-p1-r010-09-1	|dc1-p1-r010-br-1	|br-1		|4211010091		|65196|
|20	|dc1-p1-r020-09-1	|dc1-p1-r020-br-1	|br-2		|4211020091		|65197|

---
</details>

### IP-адресация оборудования и подсетей

<details>
  <summary>IP-адресации DC1</summary>
  
#### В лабе подписи интерфейсов совпадают с 4 октетом loopback (для облегчения просмотра)
|Оборудование		|Интерфейс	|IP-адрес				|Назначение|
|:-					|:-			|:-					|:-|
|dc1-p1-r002-sp-1	|Loopback0	|10.16.254.1/32		|-|
|dc1-p1-r002-sp-1	|Eth1		|10.16.250.0/31		|sp1-lf.11|
|dc1-p1-r002-sp-1	|Eth2		|10.16.250.2/31		|sp1-lf.12|
|dc1-p1-r002-sp-1	|Eth3		|10.16.250.4/31		|sp1-lf.13|
|dc1-p1-r002-sp-1	|Eth4		|10.16.250.6/31		|sp1-lf.14|
|dc1-p1-r002-sp-1	|Eth5		|10.16.250.124/31	|sp1-blf.187|
|dc1-p1-r002-sp-1	|Eth6		|10.16.250.126/31	|sp1-blf.188|
| | | | |
|dc1-p1-r012-sp-1	|Loopback0	|10.16.254.2/32 	|-|
|dc1-p1-r012-sp-1	|Eth1		|10.16.251.0/31		|sp2-lf.11|
|dc1-p1-r012-sp-1	|Eth2		|10.16.251.2/31		|sp2-lf.12|
|dc1-p1-r012-sp-1	|Eth3		|10.16.251.4/31		|sp2-lf.13|
|dc1-p1-r012-sp-1	|Eth4		|10.16.251.6/31		|sp2-lf.14|
|dc1-p1-r012-sp-1	|Eth5		|10.16.251.124/31	|sp2-blf.187|
|dc1-p1-r012-sp-1	|Eth6		|10.16.251.126/31	|sp2-blf.188|
| | | | |
|dc1-p1-r003-lf-1	|Loopback0	|10.16.254.11/32 	|-|
|dc1-p1-r003-lf-1	|Eth1		|10.16.250.1/31		|sp1-lf.11|
|dc1-p1-r003-lf-1	|Eth2		|10.16.251.1/31		|sp2-lf.11|
| | | | |
|dc1-p1-r003-lf-2	|Loopback0	|10.16.254.12/32 		|-|
|dc1-p1-r003-lf-2	|Eth1		|10.16.250.3/31		|sp1-lf.12|
|dc1-p1-r003-lf-2	|Eth2		|10.16.251.3/31		|sp2-lf.12|
| | | | |
|dc1-p1-r013-lf-1	|Loopback0	|10.16.254.13/32 	|-|
|dc1-p1-r013-lf-1	|Eth1		|10.16.250.5/31		|sp1-lf.13|
|dc1-p1-r013-lf-1	|Eth2		|10.16.251.5/31		|sp2-lf.13|
| | | | |
|dc1-p1-r013-lf-2	|Loopback0	|10.16.254.14/32 	|-|
|dc1-p1-r013-lf-2	|Eth1		|10.16.250.7/31		|sp1-lf.14|
|dc1-p1-r013-lf-2	|Eth2		|10.16.251.7/31		|sp2-lf.14|
| | | | |
|dc1-p1-r002-blf-1	|Loopback0	|10.16.254.187/32 	|-|
|dc1-p1-r002-blf-1	|Eth1		|10.16.250.125/31	|sp1-blf.187|
|dc1-p1-r002-blf-1	|Eth2		|10.16.251.125/31	|sp2-blf.187|
| | | | |
|dc1-p1-r012-blf-1	|Loopback0	|10.16.254.188/32 	|-|
|dc1-p1-r012-blf-1	|Eth1		|10.16.250.127/31	|sp1-blf.188|
|dc1-p1-r012-blf-1	|Eth2		|10.16.251.127/31	|sp2-blf.188|
| | | | |
|dc1-p1-r003-lf-1	|Po7	|10.8.10.254/24	|Клиентская сеть, VLAN 10|
|dc1-p1-r003-lf-1	|Po8	|10.8.20.254/24	|Клиентская сеть, VLAN 20|
|dc1-p1-r013-lf-1	|Po7	|10.8.10.254/24	|Клиентская сеть, VLAN 10|
|dc1-p1-r013-lf-1	|Po8	|10.8.20.254/24	|Клиентская сеть, VLAN 20|
|dc1-lfaf-103		|Eth7	|10.8.20.254/24	|Клиентская сеть, VLAN 20|
|dc1-lfaf-103		|Eth8	|10.8.30.254/24	|Клиентская сеть, VLAN 30|
| | | | |
|dc1-client-102		|Eth0	|10.8.20.102/24	|Клиентская сеть, VLAN 20|
|dc1-client-103		|Eth0	|10.8.30.103/24	|Клиентская сеть, VLAN 30|
|dc1-client-104		|Po8	|10.8.40.104/24	|Клиентская сеть, VLAN 10|
|dc1-server-201	|Po7		|10.8.10.201/24	|Клиентская сеть, VLAN 10|
|dc1-server-201	|Po7		|10.8.20.201/24	|Клиентская сеть, VLAN 20|
|dc1-server-201	|Po7		|10.8.30.201/24	|Клиентская сеть, VLAN 30|
</details>

----
IP-адресации DC2
**********************************

### Описание решения для Underlay-сети

<details>
  <summary>Описание решения</summary>

#### Описание

С точки зрения физической коммутации в решение предполагается:
- подключение к spine только leaf и border leaf
- подключение к leaf только хостов
- подключение к border leaf
  - DCI-каналов связи
  - межсетевых экранов площадки

В решении используется протокол IPv4 и протокол маршрутизации eBGP и со следующими параметрами:
- все spine одного POD в каждом DC размещены в одной AS 65x0y, где x - DC/POD, y -  третий октет в loopback первого spine POD (.y.)
- каждый leaf размещен в свой AS: leaf-xYY в AS 65xYY, где x - DC/POD, y - из третьего октета loopback leaf (.1yy.)
- на spine используются динамические peer-group с фильтром по номеру AS и транзитному блоку /25
- на leaf используются статические peer-group
- настроены keepalive-интервал 3 сек, hold time 9 сек.
- настроен maximum-paths равным 8 (по максимальному числу spine)
- настроен BGP routing updates интервал равным 0  (neighbor out-delay, установлен в 0 по умолчанию)
- настроена administrative distance равна 20 (по рекомендации Arista из предоставленной ссылке, возможно из-за iBGP между leaf в паре)
- отключена автоматическая активация BGP AFI/SFI ipv4 unicast (в данной лабе это было не обязательно)
- включен режим multi-agent model (поддежка redistribute в BGP AFI/SFI ipv4 unicast)
- включена аутентификация BGP-соседа
- настроено взаимодействие с протоколом bfd для улучшения сходимости сети
- таймеры bfd выбраны такие, чтобы сессии в EVE-NG флапали реже
</details>

  
### Описание решения для Overlay-сети
<details>
  <summary>Описание решения</summary>

В решении используется следующие параметры:
- общие параметры:
	- в overlay используется интерфейс Loopback0 на spine и leaf
	- настроено соседство между spine и leaf для BGP AFI/SFI l2vpn evpn
	- команда neighbor XXX next-hop-unchanged используется для сохранения next-hop-адреса leaf-коммутатора
	- команда redistribute learned используется для анонса MAC-адреса локальных хостов как EVPN type-2 маршрутов
	- команда neighbor XXX send-community extended используется для работы EVPN (импорта, экспорта маршрутов)
	- для маршрутизации трафика в сетевой фабрики используется модель Symmetric IRB
	- механизм ARP Suppression на коммуаторах Arista включен по умолчанию
- маршрутизация клиентских сетей:
	- для настройки шлюза на VTEP используется технология anycast gateway
	- команда ip address virtual используется для задания единого IP-адреса для anycast gateway на всех VTEP, выполняющих функцию шлюза для VLAN
	- команда ip virtual-router mac-address используется для задания единого MAC-адреса для anycast gateway, на всех VTEP, выполняющих функцию шлюза для VLAN
- параметры VNI:
	- номер L2VNI выбирается так - 1ХХХХ, где ХХХХ номер VLAN до 4000
	- номер L3VNI выбирается так - 04YYY, где 4YYY номер VLAN с 4001 по 4070.
	- номер L3VNI соотносится с номером VLAN, т.к. у части вендоров L3VNI должен соответствовать VLAN
	- номер tenant выбирается так - YYY, где YYY берется из номера L3VNI (tenant-1 -> L3VNI 4001)
- параметры RT, RT:
	- параметр RD L2VNI настраивается через auto. Коммутатор сам выставляет в RID:VLAN
	- параметр RD L3VNI настраивается вручную и задается как RID:VLAN
	- параметр RT L2VNI и L3VNI настраивается вручную, чтобы он совпадал на всех VTEP, находящихся в разных AS
	- параметр RT L2VNI и L3VNI задается так - VNI:VLAN. За счет номера VNI достигается уникальность.
- параметры EVPN Multihoming:
  	- для отказоустойчивого подключения хостов используется технология EVPN Multihoming в режиме Active-Active и протокол LACP
	- для возможности огранизации отказоустойчивого подключения хостов к двух разным leaf на leaf настаивается одинаковый lacp system-id
  	- индекc коммутатора для работв EVPN Multihoming назначается от меньшего IP-адреса Loopback0 к большему (в поле IP Address в маршруте EVPN type 4)
  	- коммутатору leaf-1 в паре присвоем индекс 0, а leaf-2 индекс 1
	- для определения Designated Forwarder (DF) использует функция mod - <VLAN> mod <количество leaf> (модель сервиса VLAN-based)
	- в качестве DF для всеx VLAN выбран leaf-1 в паре, т.к. номера VLAN деляться на 2 без остатка (10,20,30,40)
	- числовые параметрах EVPN Multihoming задаются так:
		- параметр ESI 0000:0x0y:00zz:00pp:0000
		- параметр ES-Import RT 0x0y:00zz:00pp (отбрасываются два байта слева и справа в ESI). Формат записи для облегчения понимания
		- парамет lacp system-id 0x0y.00zz.00pp 
		- x - DC, y - POD, zz - четверый октет в loopback 0, pp - номер Port Channel
- взаимодействие между VRF (tenant):
	- используется два VRF (tenant), в которых размещены все клиентские подсети
	- в tenant №1 размещены VLAN 10 и 20, в tenant №2 размещены VLAN 30 и 40
	- в VLAN 10 и 20, 30 размещено по одному серверу (server-20X). Серверы реализованы в виде VRF на общей платформе
	- для анонсирования type-5 маршрутов используется команда redistribute connected в каждом VRF секции BGP
	- взаимодействие подсетей из разных VRF, осуществляется через МЭ dc1-fw-199 с использованием технологии VRF-Lite на leaf-103:
		- между МЭ dc1-fw-199 и коммутатором leaf-103 настроены два транзитных сегмента
		- для огранизации отказоустойчивого подключения dc1-fw-199 к leaf-103 используется два канала связи и технология Etherchannel (LACP)
		- на leaf-103 по одному транзитный сегмент помещены в каждый VRF
		- на dc1-fw-199 настроены оба транзитных сегмента без разделения на VRF
	- взаимодействие межу МЭ dc1-fw-199 (AS 65199) и  leaf-103 (AS 65103) осуществляется с использованием протокола eBGP
	- параметры протокола eBGP заданы аналогичными параметрам eBGP для underlay, кроме поддержки extended community
	- на МЭ dc1-fw-199 используется BGP AFI/SFI ipv4 unicast
	- МЭ dc1-fw-199 анонсирует в сторону leaf-103 маршрут по умолчанию
	- коммутатор leaf-103 анонсирует клиентские подсети в сторону МЭ dc1-fw-199 (являющиеся type-5 маршрутами в EVPN)
	- коммутатор leaf-103 не анонсирует маршруты до хостов (/32) в сторону МЭ dc1-fw-199 (являющиеся type-2 маршрутами в EVPN)
	- запрет анонса маршрутов /32 реализуется с ипользованием префикс-листа - анонсировать клиентские подсети (10.8.X.X) с маской не длиннее /31
</details>

### Описание решения DCI
<details>
  <summary>Описание решения</summary>

описание
</details>

### Cхема решения
<details>
  <summary>Cхема решения</summary>

![Изображение](https://github.com/takmenevag/otus-dc-design/blob/main/labs/lab8/scheme/lab8_scheme.PNG "Схема стенда")
</details>


### Параметы VXLAN в Overlay-сети 
<details>
  <summary>Описание параметров</summary>
  
#### В решении используется два tenant
|VRF	|Тип VNI |Номер VNI	|Номер VLAN	|Значение RT| Значение RD|
|:-			|:-		|:-		|:-		|:-			|:-|
|tenant-1	|L3VNI	|4001	|4001	|4001:4001	|RID:4001|
|tenant-1	|L2VNI	|10010	|10 	|10010:10	|RID:10|
|tenant-1	|L2VNI	|10020	|20		|10020:20	|RID:20|
| | | | |
|tenant-2	|L3VNI	|4002	|4002	|4002:4002	|RID:4002|
|tenant-2	|L2VNI	|10030	|30 	|10010:30	|RID:30|
|tenant-2	|L2VNI	|10040	|40		|10020:40	|RID:40|

#### В решении используется следующие параметры EVPN Multihoming
|DC	|Оборудование 		|Порт	|ESI 						|ES-Import RT 		|LACP system-id|
|:- |:-					|:-		|:-							|:-					|:-|
|1	|dc1-p1-r003-lf-1 	|Po7	|0000:0101:0011:0007:0000 	|01:01:00:11:00:07 	|0101.0011.0007|
|1	|dc1-p1-r003-lf-1 	|Po8	|0000:0101:0011:0008:0000 	|01:01:00:11:00:08 	|0101.0011.0008|
|1	|dc1-p1-r003-lf-2 	|Po7	|0000:0101:0011:0007:0000 	|01:01:00:11:00:07 	|0101.0011.0007|
|1	|dc1-p1-r003-lf-2 	|Po8	|0000:0101:0011:0008:0000 	|01:01:00:11:00:08 	|0101.0011.0008|
|1	|dc1-p1-r013-lf-1 	|Po7	|0000:0101:0013:0007:0000 	|01:01:00:13:00:07 	|0101.0013.0007|
|1	|dc1-p1-r013-lf-2 	|Po7	|0000:0101:0013:0007:0000 	|01:01:00:13:00:07 	|0101.0013.0007|
|	|	|	|	|	|
|2	|dc2-p1-r003-lf-1 	|Po7	|0000:0201:0011:0007:0000 	|02:01:00:11:00:07 	|0201.0011.0007|
|2	|dc2-p1-r003-lf-2 	|Po7	|0000:0201:0011:0007:0000 	|02:01:00:11:00:07 	|0201.0011.0007|

</details>

### Настройка оборудования

<details>
  <summary>Команды для настройки DC1 </summary>

- dc1-p1-r002-sp-1 (spine-1)
```

```
- dc1-p1-r012-sp-1 (spine-2)
```

```

- dc1-p1-r003-lf-1 (leaf-11)
```

```

- dc1-p1-r003-lf-2 (leaf-12)
```

```

- dc1-p1-r013-lf-1 (leaf-13)
```

```

- dc1-p1-r013-lf-1 (leaf-14)
```

```

- dc1-p1-r002-lf-1 (boleaf-187)
```

```

- dc1-p1-r012-lf-1 (boleaf-188)
```

```

- dc1-p1-r009-fw-1 (fw-1)
```

```

- dc1-p1-r019-fw-1 (fw-2)
```
по факту отсутствует, т.к. кластер эмулируется одним устройством
```

- dc1-vlX-s201
```

```

- dc1-vlx-c101
```

```

- dc1-vl10-h151
```

```

</details>

<details>
  <summary>Команды для настройки DC2 </summary>

- dc2-p1-r002-sp-1 (spine-1)
```

```
- dc2-p1-r012-sp-1 (spine-2)
```

```

- dc2-p1-r003-lf-1 (leaf-11)
```

```

- dc2-p1-r003-lf-2 (leaf-12)
```

```

- dc2-p1-r013-lf-1 (leaf-13)
```

```

- dc2-p1-r013-lf-1 (leaf-14)
```

```

- dc2-p1-r002-lf-1 (boleaf-187)
```

```

- dc2-p1-r012-lf-1 (boleaf-188)
```

```

- dc2-p1-r009-fw-1 (fw-1)
```

```

- dc2-p1-r019-fw-1 (fw-2)
```
по факту отсутствует, т.к. кластер эмулируется одним устройством
```

- dc2-vlX-s201
```

```

- dc2-vlx-c101
```

```

- dc2-vl10-h151
```

```

</details>

### Вывод ip/mac хостов

<details>
  <summary>Вывод ip/mac хостов </summary>
  
```

```

</details>

### Проверка взаимодействия DC1

<details>
  <summary>Проверки dc1-p1-r002-sp-1 (spine-1)</summary>
  
```

```

</details>

<details>
  <summary>Проверки dc1-p1-r012-sp-1 (spine-2)</summary>
  
```

```

</details>

<details>
  <summary>Проверки dc1-p1-r003-lf-1 (leaf-11)</summary>
  
```

```

</details>

<details>
  <summary>Проверки dc1-p1-r003-lf-2 (leaf-12)</summary>
  
```

```

</details>

<details>
  <summary>Проверки dc1-p1-r013-lf-1 (leaf-13)</summary>
  
```

```

</details>

<details>
  <summary>Проверки dc1-p1-r013-lf-1 (leaf-14)</summary>
  
```

```

</details>

<details>
  <summary>Проверки dc1-p1-r002-lf-1 (boleaf-187)</summary>
  
```

```

</details>

<details>
  <summary>Проверки dc1-p1-r012-lf-1 (boleaf-188)</summary>
  
```

```

</details>

<details>
  <summary>Проверки dc1-p1-r009-fw-1 (fw-1)</summary>
  
```

```

</details>

### Проверка взаимодействия DC2


<details>
  <summary>Проверки dc2-p1-r002-sp-1 (spine-1)</summary>
  
```

```

</details>

<details>
  <summary>Проверки dc2-p1-r012-sp-1 (spine-2)</summary>
  
```

```

</details>

<details>
  <summary>Проверки dc2-p1-r003-lf-1 (leaf-11)</summary>
  
```

```

</details>

<details>
  <summary>Проверки dc2-p1-r003-lf-2 (leaf-12)</summary>
  
```

```

</details>

<details>
  <summary>Проверки dc2-p1-r013-lf-1 (leaf-13)</summary>
  
```

```

</details>

<details>
  <summary>Проверки dc2-p1-r013-lf-1 (leaf-14)</summary>
  
```

```

</details>

<details>
  <summary>Проверки dc2-p1-r002-lf-1 (boleaf-187)</summary>
  
```

```

</details>

<details>
  <summary>Проверки dc2-p1-r012-lf-1 (boleaf-188)</summary>
  
```

```

</details>

<details>
  <summary>Проверки dc2-p1-r009-fw-1 (fw-1)</summary>
  
```

```

</details>

<details>
  <summary>ping внутри и между VRF</summary>

- из VRF tenant-1 в VRF tenant-2 \
_client-102 подключен к leaf-103, поэтому в трассировке только leaf-103 и fw-199_
```

```

- из VRF tenant-2 в VRF tenant-2 \
_client-104 подключен к leaf-101, поэтому в трассировке еще leaf-103_
```
```
</details>


<details>
  <summary>Трассировка внутри и между VRF</summary>

- из VRF tenant-1 в VRF tenant-2 \
_client-102 подключен к leaf-103, поэтому в трассировке только leaf-103 и fw-199_
```

```

- из VRF tenant-2 в VRF tenant-2 \
_client-104 подключен к leaf-101, поэтому в трассировке еще leaf-103_
```
```
</details>

### Масштабирование решение
<details>
  <summary>Описание мастабирования решения</summary>
  
#### Решение поддерживает следующие возможности мастабирования:
- увеличение числа DC до 4 шт. или POD до 2 шт. в каждом DC (с использованием 2 байтных номеров AS)
- увеличение числа DC до 8 шт., POD до 4 шт. в кажом DC (с использованием 4 байтных номеров AS)
- увеличение числа spine в каждом POD до 6-8 шт. (ограничение по количеству uplink-портов на leaf)
- увеличение числа leaf в каждом POD до 70 шт. или с использованием 2 байтных номеров AS
- увеличение числа leaf в каждом POD до 127 шт. с использованием 2 байтных номеров AS в зависимости от: 
	- портовой емкости spine (128 портов)
	- размера транспортного сегмента (сеть с маской /25)
	- физических ограничений по размещению leaf (1U) и spine (4U)
- увеличение числа tenant до 90 шт.
- увеличение числа сетевых сегментов в каждом tenant до исчерпания блока 10.8.0.0/14  

Отдельно отметим, что увеличение числа DC потребует увеличение количества каналов связи между ними. \
В зависимости от итоговой технической возможности по огранизации данных каналов связи, возможно \
изменение физической архитектуры сегмента DCI
</details>

### Итоговые конфигурации оборудования
- [dc1-spine-1](https://github.com/takmenevag/otus-dc-design/blob/main/labs/lab8/config/dc1-spine-1.txt)
- [dc1-spine-2](https://github.com/takmenevag/otus-dc-design/blob/main/labs/lab8/config/dc1-spine-2.txt)
- [dc1-leaf-101](https://github.com/takmenevag/otus-dc-design/blob/main/labs/lab8/config/dc1-leaf-101.txt)
- [dc1-leaf-102](https://github.com/takmenevag/otus-dc-design/blob/main/labs/lab8/config/dc1-leaf-102.txt)
- [dc1-leaf-103](https://github.com/takmenevag/otus-dc-design/blob/main/labs/lab8/config/dc1-leaf-103.txt)
- [dc1-fw-199](https://github.com/takmenevag/otus-dc-design/blob/main/labs/lab8/config/dc1-fw-199.txt)
- [dc1-client-102](https://github.com/takmenevag/otus-dc-design/blob/main/labs/lab8/config/dc1-client-102.txt)
- [dc1-client-103](https://github.com/takmenevag/otus-dc-design/blob/main/labs/lab8/config/dc1-client-103.txt)
- [dc1-client-104](https://github.com/takmenevag/otus-dc-design/blob/main/labs/lab8/config/dc1-client-104.txt)
- [dc1-server-201](https://github.com/takmenevag/otus-dc-design/blob/main/labs/lab8/config/dc1-server-201.txt)
---

[**Вернуться обратно**](https://github.com/takmenevag/otus-dc-design/tree/main/)
